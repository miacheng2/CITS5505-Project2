<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <p>This is the home page</p>
    <p id="currentUser"></p>
    <a href="/login">Login</a>
    <a href="/logout">Logout</a>
    <a href="/profile">Profile</a>
    <form onsubmit="sendPost()" return false;>
        <h3>Create a new post here:</h3>
        <!-- required means the input box has to have a value before submission. -->
        <input type="text" id="new_post_title" placeholder="Title goes Here~" required />
        <input type="text" id="new_post_content" placeholder="Post content goes Here~" requied />

        <button type="submit" id="post_btn" disabled>Post post</button>
        <p id="login_warning">You have to login to Post! </p>
    </form>

    <div id="postsBox"></div>

</body>

<script type="module">
    import { jwtToken, userId, userName, post_array, getPost, sendReply, sendPost } from '../static/js_module.js';
    // When the page is loaded, do following things

    window.onload = function () {

        getPost(jwtToken).then(() => {
            document.getElementById("post_btn").disabled = false;
            document.getElementById("login_warning").style.display = "none";
            document.getElementById("currentUser").innerHTML = "Hi," + userName;

            for (var i = post_array.length - 1; i >= 0; i--) {
                var temp_content = '<h2>' + post_array[i].authorName + ' posted on: ' + post_array[i].date + ', Said: ' + post_array[i].title + '</h2><h5>' + post_array[i].content + '</h5>';
                var temp_input = '<input type="text" id=' + post_array[i].id + ' placeholder="Comment Here~" required/>'
                var temp_btn = '<button type="submit">Post Comment</button>'
                var temp_replys = ''
                for (var n = 0; n < post_array[i].replyData.length; n++) {
                    temp_replys += '<p>At ' + post_array[i].replyData[n].date + ' ' + post_array[i].replyData[n].authorName + ' commented:</p> <p> ' + post_array[i].replyData[n].content + ' </p>'
                }
                document.getElementById("postsBox").innerHTML += '<div><form onsubmit="sendReply(' + post_array[i].id + '); return false;">' + temp_content + temp_replys + temp_input + temp_btn + '</form></div>'
            }

        }).catch(error => {
            console.error("An error occurred:", error);
        });
    }

    window.sendReply = sendReply;

    window.sendPost = sendPost;

</script>

</html>